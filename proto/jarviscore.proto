syntax = "proto3";

package jarviscorepb;

enum CODE {
    OK = 0;

    INVALID_TOKEN_NAME = 1;    // token/name fail 
    ALREADY_IN = 2;    // already in
    FORWARD_MSG = 3;    // forward msg
    BROADCAST_MSG = 4;    // broadcast msg
}

enum NODETYPE {
    NORMAL = 0;
    SH = 1;
    TELEBOT = 2;
}

enum CHANNELTYPE {
    NODEINFO = 0;
    CTRL = 1;
}

message Join {
    string servAddr = 1;
    string token = 2;
    string name = 3;
    NODETYPE nodeType = 4;
}

message ReplyJoin {
    CODE code = 1;
    string token = 2;
    string name = 3;
    NODETYPE nodeType = 4;
}

message BaseReply {
    CODE code = 1;
}

message Subscribe {
    CHANNELTYPE channelType = 1;
    string token = 2;
}

message NodeInfo {
    string servAddr = 1;
    string token = 2;
    string name = 3;
    NODETYPE nodeType = 4;
}

message CtrlInfo {
    int64 ctrlid = 1;
    string destToken = 2;
    string srcToken = 3;
    string myToken = 4;
    string ctrlString = 5;
    int32 forwordNums = 6;
}

message CtrlResult {
    int64 ctrlid = 1;
    string destToken = 2;
    string srcToken = 3;
    string myToken = 4;
    string ctrlResult = 5;
    int32 forwordNums = 6;
}

message ChannelInfo {
    CHANNELTYPE channelType = 1;
    oneof data {
        NodeInfo nodeInfo = 2;
        CtrlInfo ctrlInfo = 3;
    }
}

service JarvisCoreServ {
    rpc join (Join) returns (ReplyJoin) {}
    rpc requestCtrl (CtrlInfo) returns (BaseReply) {}
    rpc replyCtrl (CtrlResult) returns (BaseReply) {}
    rpc subscribe (Subscribe) returns (stream ChannelInfo) {}
}